apiVersion: v1
kind: Pod
metadata:
  annotations:
    cni.projectcalico.org/podIPs: 172.24.19.57
    k8s.v1.cni.cncf.io/network-status: |-
      [{
          "name": "hybridnet",
          "interface": "eth0",
          "ips": [
              "172.24.19.57"
          ],
          "mac": "02:12:34:bb:54:e1",
          "default": true,
          "dns": {},
          "gateway": [
              "\u003cnil\u003e"
          ]
      }]
    networking.alibaba.com/handled-by-webhook: "true"
    networking.alibaba.com/ip-family: IPv4Only
    networking.alibaba.com/network-type: Overlay
  creationTimestamp: "2024-07-05T08:17:22Z"
  labels:
    app: dlrover
    elasticjob.dlrover/name: torch-nanogpt
    elasticjob.dlrover/rank-index: "0"
    elasticjob.dlrover/relaunch-count: "0"
    elasticjob.dlrover/replica-index: "0"
    elasticjob.dlrover/replica-type: worker
  name: torch-nanogpt-edljob-worker-0
  namespace: dlrover
  ownerReferences:
    - apiVersion: elastic.iml.github.io/v1alpha1
      blockOwnerDeletion: true
      kind: ElasticJob
      name: torch-nanogpt
      uid: 70de2e00-44a1-42a1-8b2d-22dd592ff7c9
  resourceVersion: "19034950"
  uid: b1baa7ef-5339-4c88-883c-c8add57a71d7
spec:
  containers:
    - command:
        - /bin/bash
        - -c
        - dlrover-run --network-check --exclude-straggler --nnodes=$NODE_NUM --nproc_per_node=1
          --max_restarts=1 --rdzv_conf pend_timeout=600 ./examples/pytorch/nanogpt/train.py  --data_dir
          /data/nanogpt/
      env:
        - name: POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: NODE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: ELASTIC_JOB_NAME
          value: torch-nanogpt
        - name: JOB_UID
          value: 70de2e00-44a1-42a1-8b2d-22dd592ff7c9
        - name: GRPC_ENABLE_FORK_SUPPORT
          value: "False"
        - name: NODE_TYPE
          value: worker
        - name: NODE_ID
          value: "0"
        - name: NODE_NUM
          value: "4"
        - name: NODE_RANK
          value: "0"
        - name: WORLD_SIZE
          value: "4"
        - name: RANK
          value: "0"
        - name: WORKER_TYPE
          value: worker
        - name: WORKER_ID
          value: "0"
        - name: WORKER_NUM
          value: "4"
        - name: WORKER_RANK
          value: "0"
        - name: DLROVER_MASTER_ADDR
          value: elasticjob-torch-nanogpt-dlrover-master:50001
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: MONITOR_ENABLED
          value: "true"
      image: registry.cn-hangzhou.aliyuncs.com/intell-ai/dlrover:pytorch-example
      imagePullPolicy: Always
      name: main
      resources:
#        limits:
#          cpu: "4"
#          memory: 16Gi
#          nvidia.com/gpu: "1"
#        requests:
#          cpu: "4"
#          memory: 16Gi
#          nvidia.com/gpu: "1"
        limits:
          alipay.com/virtual.gpu.specification: "T4.small"
          alipay.com/virtual.gpu.count: "2"
        requests:
          alipay.com/virtual.gpu.specification: "T4.small"
          alipay.com/virtual.gpu.count: "2"
        virtualGpus:
          - name: T4.small
            node:
            gpuIndex:
            physicalGpuSpecification: "NVIDIA T4"
          - name: T4.small
            node:
            gpuIndex:
            physicalGpuSpecification: "NVIDIA T4"
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
        - mountPath: /dev/shm
          name: dshm
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access-f7xk8
          readOnly: true
  dnsPolicy: ClusterFirst
  enableServiceLinks: true
  nodeName: izbp15e6868g14106cmsx0z
  nodeSelector:
    networking.alibaba.com/overlay-network-attachment: "true"
  preemptionPolicy: PreemptLowerPriority
  priority: 0
  restartPolicy: Never
  schedulerName: default-scheduler
  securityContext: {}
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
  volumes:
    - emptyDir:
        medium: Memory
      name: dshm
    - name: kube-api-access-f7xk8
      projected:
        defaultMode: 420
        sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
                - key: ca.crt
                  path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
                - fieldRef:
                    apiVersion: v1
                    fieldPath: metadata.namespace
                  path: namespace
status:
  conditions:
    - lastProbeTime: null
      lastTransitionTime: "2024-07-05T08:17:22Z"
      reason: PodCompleted
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2024-07-05T08:19:26Z"
      reason: PodCompleted
      status: "False"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2024-07-05T08:19:26Z"
      reason: PodCompleted
      status: "False"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2024-07-05T08:17:22Z"
      status: "True"
      type: PodScheduled
  containerStatuses:
    - containerID: containerd://4f6bdfb020ba468d62cb8b7d89fa8cf0b33c6974546c86aa8786d97ddd271ceb
      image: registry.cn-hangzhou.aliyuncs.com/intell-ai/dlrover:pytorch-example
      imageID: registry.cn-hangzhou.aliyuncs.com/intell-ai/dlrover@sha256:e84dabd9b736995b3d214bdab52a7adec9848f4b7d938d23115d2f960efd196e
      lastState: {}
      name: main
      ready: false
      restartCount: 0
      started: false
      state:
        terminated:
          containerID: containerd://4f6bdfb020ba468d62cb8b7d89fa8cf0b33c6974546c86aa8786d97ddd271ceb
          exitCode: 0
          finishedAt: "2024-07-05T08:19:26Z"
          reason: Completed
          startedAt: "2024-07-05T08:17:24Z"
  hostIP: 172.16.242.14
  phase: Succeeded
  podIP: 172.24.19.57
  podIPs:
    - ip: 172.24.19.57
  qosClass: Guaranteed
  startTime: "2024-07-05T08:17:22Z"
